# 1855 Leaves of Grass Variorum

- [Overview](#overview)
- [Setup](#setup)
- [Variorum Generation](#variorum-generation)
  - [Works](#works)
  - [IIIF Manifests](#iiif-manifests)
  - [HTML](#html)

## Overview

This data repository houses the XSLT and Ruby scripts used to create all the components of the 1855 Leaves of Grass variorum. It also has several XML files which are integral to the variorum, but the bulk of the TEI which it relies on can be found in the Whitman Archive's Cocoon site (manuscripts, marginalia, marginalia annotations, notebooks).

Some of the outputs of scripts available in this repository are the actual HTML of the variorum, a list of works, and IIIF manifests.

## Setup

For information about how to set up this repository and its scripts, please visit [datura](https://github.com/CDRH/datura).  You will need Ruby, Datura, Saxon-HE, and gems required by the Datura software to run these scripts.

Due to these scripts needing access to TEI-XML located in the Whitman Archive's cocoon site, this repository must be located relative to the cocoon site as follows:

```
same_dir/cocoon/whitmanarchive
same_dir/data/collections/whitman-variorum
```

## Variorum Generation

Please refer to the below sections for more information about scripts and behavior. For those who just can't wait, you can run the following to regenerate everything possible:

```
# for production add flag -e production
bundle exec post -x html,iiif
```

This will generate a list of works and files which reference them, manifests for the 1855 Leaves of Grass and snippets for comparison, as well as the variorum HTML itself.

### Works

To update those TEI files (in cocoon) which are being searched for works, please edit `source/authority/files_with_works.txt`, then re-run the HTML post script. Results will be output to `source/authority/work_list_generated.xml` and the variorum will be updated.

`bundle exec post -x html`

The following are required for this script to execute correctly:

- manuscripts/marginalia/tei/*
- manuscripts/marginalia/tei-annotations/*
- manuscripts/tei/*
- manuscripts/notebooks/tei/*

### IIIF Manifests

There are multiple IIIF manifests generated by scripts in this repo.

- a single manifest for the 1855 Leaves of Grass edition, with table of contents
- multiple manifests, one for each snippet, which may include more than one image (clip + original page)

To update the snippets, download the snippets spreadsheet as a CSV and stick it in the data repo at `source/authority/snippets.csv`.

```
bundle exec post -x iiif
```

The snippets process also creates a JS file, `output/[environment]/manifests/snippets/index.js` which contains information about how to relate all of the manifests.

If you are pulling the data repository changes to the server that the pages which use the manifests are calling, you should see the changes upon hard refreshing.

### HTML

The variorum is currently set up to run in two ways:  either on-the-fly in cocoon using XSL variables OR as pregenerated HTML using variables from `config/public.yml`.
